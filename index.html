<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAU Africa - Admin Portal Access</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298, #87ceeb);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 50px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        h1 {
            color: #2a5298;
            margin-bottom: 30px;
            text-align: center;
        }

        .admin-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .code-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #4169e1;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 10px 0;
            white-space: pre-wrap;
        }

        .instruction {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }

        .warning {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }

        .btn {
            background: linear-gradient(45deg, #4169e1, #87ceeb);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }

        h2 {
            color: #2a5298;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        h3 {
            color: #4169e1;
            margin: 20px 0 10px 0;
        }

        ul, ol {
            margin-left: 20px;
            line-height: 1.8;
        }

        .highlight {
            background: #ffd700;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        .step {
            background: white;
            border: 2px solid #4169e1;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß TAU Africa - Admin Portal Integration</h1>
        
        <div class="admin-card">
            <h2 style="color: white; margin: 0 0 15px 0;">‚ú® Complete Integration Solution</h2>
            <p>Add admin access button + activity/task validation features to your TAU Africa system</p>
        </div>

        <div class="instruction">
            <strong>üìã What This Adds:</strong>
            <ul style="margin-top: 10px;">
                <li>Admin Access button in member login modal</li>
                <li>Access control with role-based permissions</li>
                <li>Activity & Task validation interface in database</li>
                <li>Notification system for validations</li>
            </ul>
        </div>

        <!-- STEP 1: Add Admin Button -->
        <div class="step">
            <h2>Step 1: Add Admin Access Button to Member Login</h2>
            
            <div class="code-section">
                <p><strong>Find your showRealMemberLogin() function in index (46).html</strong></p>
                <p>Add this code right BEFORE the closing &lt;/div&gt; of the modal-content:</p>
            </div>

            <div class="code-block"><!-- ADD THIS BEFORE THE CLOSING </div> OF MODAL-CONTENT -->
<div style="margin-top: 30px; padding: 20px; background: linear-gradient(45deg, #667eea, #764ba2); border-radius: 15px; text-align: center;">
    <h3 style="color: white; margin-bottom: 15px;">üë®‚Äçüíº Admin & Validator Access</h3>
    <p style="color: white; margin-bottom: 15px; font-size: 14px;">
        Authenticate activities, tasks, and manage member data
    </p>
    <button class="btn" onclick="openAdminDatabase()" 
            style="background: white; color: #667eea; font-weight: bold; width: 100%;">
        üîê Open Admin Dashboard
    </button>
</div></div>
        </div>

        <!-- STEP 2: Add JavaScript Functions -->
        <div class="step">
            <h2>Step 2: Add Admin Access Functions</h2>
            
            <div class="code-section">
                <p><strong>Add this JavaScript code to your &lt;script&gt; section in index (46).html:</strong></p>
                <p>Place it anywhere after your existing functions, before the closing &lt;/script&gt; tag:</p>
            </div>

            <div class="code-block">// ===== ADMIN DATABASE ACCESS WITH ROLE CHECKING =====
function openAdminDatabase() {
    const currentMember = window.TauDB?.getCurrentMember();
    
    // Define admin/validator roles
    const ADMIN_ROLES = ['admin', 'validator', 'moderator'];
    const ADMIN_IDS = ['TSK-000000-001', 'TLK-000000-001']; // Add your admin Member IDs
    const ADMIN_EMAILS = [
        'admin@tauafrica.org',
        'validator@tauafrica.org',
        'grouptauafrica@gmail.com'
    ];
    
    // Check if user has admin access
    const hasAccess = currentMember && (
        ADMIN_IDS.includes(currentMember.id) ||
        ADMIN_EMAILS.includes(currentMember.email) ||
        ADMIN_ROLES.includes(currentMember.role)
    );
    
    if (hasAccess) {
        // User has admin access - open database
        const dbWindow = window.open('databse.html', '_blank', 'width=1400,height=900');
        
        if (!dbWindow) {
            showNotification('‚ö†Ô∏è Please allow popups for this site', 'error');
            // Fallback: Open in same tab
            window.location.href = 'databse.html';
        } else {
            showNotification('‚úÖ Opening Admin Dashboard...', 'success');
        }
    } else {
        // User doesn't have access - show access request
        showAdminAccessRequest();
    }
}

function showAdminAccessRequest() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    modal.innerHTML = `
        <div class="modal-content">
            <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
            <h2 style="color: #2a5298;">üîê Admin Access Request</h2>
            <p>This area is restricted to admins and validators only.</p>
            
            <form onsubmit="requestAdminAccess(event)">
                <div class="form-group">
                    <label>Admin Access Code</label>
                    <input type="password" id="adminAccessCode" placeholder="Enter admin code" required>
                </div>
                <button type="submit" class="btn">Verify & Access</button>
            </form>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                <small><strong>Need admin access?</strong></small>
                <p style="margin-top: 10px; font-size: 13px;">Contact: grouptauafrica@gmail.com</p>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function requestAdminAccess(event) {
    event.preventDefault();
    const code = document.getElementById('adminAccessCode').value;
    const correctCode = 'TAU2025ADMIN'; // Change this to your secret code
    
    if (code === correctCode) {
        closeAllModals();
        const dbWindow = window.open('databse.html', '_blank', 'width=1400,height=900');
        if (!dbWindow) {
            showNotification('‚ö†Ô∏è Please allow popups', 'error');
            window.location.href = 'databse.html';
        }
        showNotification('‚úÖ Access granted!', 'success');
    } else {
        showNotification('‚ùå Invalid access code', 'error');
    }
}</div>
        </div>

        <!-- STEP 3: Add Validation Features to Database -->
        <div class="step">
            <h2>Step 3: Add Activity/Task Validation to Database</h2>
            
            <div class="code-section">
                <p><strong>Add this code to your databse.html file:</strong></p>
                <p>Place it in the &lt;script&gt; section, after the existing functions:</p>
            </div>

            <div class="code-block">// ===== ACTIVITY & TASK VALIDATION SYSTEM =====
function showValidationTab() {
    const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
    
    // Get all pending activities and tasks
    const pendingActivities = [];
    const pendingTasks = [];
    
    members.forEach(member => {
        if (member.activities) {
            member.activities.forEach(activity => {
                if (activity.status === 'Pending' || activity.status === 'Active') {
                    pendingActivities.push({
                        ...activity,
                        memberId: member.id,
                        memberName: member.fullName
                    });
                }
            });
        }
        
        if (member.tasks) {
            member.tasks.forEach(task => {
                if (task.status === 'Assigned' || task.status === 'In Progress') {
                    pendingTasks.push({
                        ...task,
                        memberId: member.id,
                        memberName: member.fullName
                    });
                }
            });
        }
    });
    
    return `
        <div class="validation-section">
            <h2>üìã Activity Validation (${pendingActivities.length})</h2>
            <div class="validation-list">
                ${pendingActivities.length > 0 ? pendingActivities.map(activity => `
                    <div class="validation-card">
                        <h3>${activity.title || activity.type}</h3>
                        <p><strong>Member:</strong> ${activity.memberName} (${activity.memberId})</p>
                        <p><strong>Description:</strong> ${activity.description}</p>
                        <p><strong>Reward:</strong> ${activity.iKbpReward} iKbp</p>
                        <p><strong>Date:</strong> ${new Date(activity.dateAdded).toLocaleDateString()}</p>
                        <div class="validation-actions">
                            <button class="btn btn-success" onclick="approveActivity('${activity.memberId}', '${activity.id}')">
                                ‚úì Approve & Award
                            </button>
                            <button class="btn btn-secondary" onclick="rejectActivity('${activity.memberId}', '${activity.id}')">
                                ‚úó Reject
                            </button>
                        </div>
                    </div>
                `).join('') : '<p>No pending activities</p>'}
            </div>
            
            <h2 style="margin-top: 40px;">‚úÖ Task Validation (${pendingTasks.length})</h2>
            <div class="validation-list">
                ${pendingTasks.length > 0 ? pendingTasks.map(task => `
                    <div class="validation-card">
                        <h3>${task.title}</h3>
                        <p><strong>Member:</strong> ${task.memberName} (${task.memberId})</p>
                        <p><strong>Description:</strong> ${task.description}</p>
                        <p><strong>Category:</strong> ${task.category}</p>
                        <p><strong>Reward:</strong> ${task.iKbpReward} iKbp</p>
                        <p><strong>Assigned:</strong> ${new Date(task.dateAssigned).toLocaleDateString()}</p>
                        <div class="validation-actions">
                            <button class="btn btn-success" onclick="approveTask('${task.memberId}', '${task.id}')">
                                ‚úì Approve & Complete
                            </button>
                            <button class="btn btn-secondary" onclick="rejectTask('${task.memberId}', '${task.id}')">
                                ‚úó Reject
                            </button>
                        </div>
                    </div>
                `).join('') : '<p>No pending tasks</p>'}
            </div>
        </div>
    `;
}

function approveActivity(memberId, activityId) {
    const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
    const member = members.find(m => m.id === memberId);
    
    if (!member) {
        showNotification('Member not found', 'error');
        return;
    }
    
    const activity = member.activities.find(a => a.id === activityId);
    if (!activity) {
        showNotification('Activity not found', 'error');
        return;
    }
    
    // Approve and award
    activity.status = 'Approved';
    activity.approvedDate = new Date().toISOString();
    member.iKbpBalance = (member.iKbpBalance || 0) + activity.iKbpReward;
    
    // Save
    localStorage.setItem('tauAfricaDB', JSON.stringify(members));
    
    // Send notification to member
    sendValidationNotification(member, 'activity', 'approved', activity);
    
    showNotification(`‚úÖ Activity approved! ${member.fullName} earned ${activity.iKbpReward} iKbp`, 'success');
    renderValidationTab();
}

function rejectActivity(memberId, activityId) {
    const reason = prompt('Reason for rejection:');
    if (!reason) return;
    
    const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
    const member = members.find(m => m.id === memberId);
    
    if (!member) return;
    
    const activity = member.activities.find(a => a.id === activityId);
    if (!activity) return;
    
    activity.status = 'Rejected';
    activity.rejectionReason = reason;
    activity.rejectedDate = new Date().toISOString();
    
    localStorage.setItem('tauAfricaDB', JSON.stringify(members));
    sendValidationNotification(member, 'activity', 'rejected', activity);
    
    showNotification('Activity rejected', 'info');
    renderValidationTab();
}

function approveTask(memberId, taskId) {
    const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
    const member = members.find(m => m.id === memberId);
    
    if (!member) return;
    
    const task = member.tasks.find(t => t.id === taskId);
    if (!task) return;
    
    task.status = 'Completed';
    task.completedDate = new Date().toISOString();
    member.iKbpBalance = (member.iKbpBalance || 0) + task.iKbpReward;
    
    localStorage.setItem('tauAfricaDB', JSON.stringify(members));
    sendValidationNotification(member, 'task', 'approved', task);
    
    showNotification(`‚úÖ Task approved! ${member.fullName} earned ${task.iKbpReward} iKbp`, 'success');
    renderValidationTab();
}

function rejectTask(memberId, taskId) {
    const reason = prompt('Reason for rejection:');
    if (!reason) return;
    
    const members = JSON.parse(localStorage.getItem('tauAfricaDB') || '[]');
    const member = members.find(m => m.id === memberId);
    
    if (!member) return;
    
    const task = member.tasks.find(t => t.id === taskId);
    if (!task) return;
    
    task.status = 'Rejected';
    task.rejectionReason = reason;
    
    localStorage.setItem('tauAfricaDB', JSON.stringify(members));
    sendValidationNotification(member, 'task', 'rejected', task);
    
    showNotification('Task rejected', 'info');
    renderValidationTab();
}

function sendValidationNotification(member, type, action, item) {
    const NOTIF_KEY = 'tauNotifications';
    const allNotifications = JSON.parse(localStorage.getItem(NOTIF_KEY) || '{}');
    
    if (!allNotifications[member.id]) {
        allNotifications[member.id] = [];
    }
    
    const notification = {
        id: `NOTIF-${Date.now()}`,
        title: action === 'approved' 
            ? `${type === 'activity' ? 'Activity' : 'Task'} Approved!` 
            : `${type === 'activity' ? 'Activity' : 'Task'} Rejected`,
        message: action === 'approved'
            ? `Your ${type} "${item.title || item.type}" has been approved! You earned ${item.iKbpReward} iKbp.`
            : `Your ${type} "${item.title || item.type}" was rejected. Reason: ${item.rejectionReason}`,
        timestamp: new Date().toISOString(),
        read: false,
        type: action
    };
    
    allNotifications[member.id].unshift(notification);
    localStorage.setItem(NOTIF_KEY, JSON.stringify(allNotifications));
}

function renderValidationTab() {
    const validationTab = document.getElementById('validationTab');
    if (validationTab) {
        validationTab.innerHTML = showValidationTab();
    }
}</div>

            <div class="code-section">
                <p><strong>Add this CSS to the &lt;style&gt; section in databse.html:</strong></p>
            </div>

            <div class="code-block">.validation-section {
    padding: 20px 0;
}

.validation-list {
    display: grid;
    gap: 20px;
    margin: 20px 0;
}

.validation-card {
    background: white;
    border: 2px solid #eee;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.validation-card h3 {
    color: #2a5298;
    margin-bottom: 15px;
}

.validation-card p {
    margin: 8px 0;
    color: #666;
}

.validation-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.validation-actions .btn {
    flex: 1;
    padding: 10px;
    font-size: 14px;
}</div>

            <div class="code-section">
                <p><strong>Add Validation tab to your database tabs:</strong></p>
                <p>In the tabs section of databse.html, add this button:</p>
            </div>

            <div class="code-block"><button class="tab" onclick="switchTab('validation')">‚úÖ Validate</button></div>

            <div class="code-section">
                <p><strong>Add Validation tab content:</strong></p>
                <p>After the other tab-content divs, add:</p>
            </div>

            <div class="code-block"><div id="validationTab" class="tab-content">
    <!-- Content will be populated by JavaScript -->
</div></div>

            <div class="code-section">
                <p><strong>Update your switchTab function:</strong></p>
            </div>

            <div class="code-block">function switchTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    event.target.classList.add('active');
    
    // Special handling for validation tab
    if (tab === 'validation') {
        const validationTab = document.getElementById('validationTab');
        validationTab.innerHTML = showValidationTab();
        validationTab.classList.add('active');
    } else {
        document.getElementById(tab + 'Tab').classList.add('active');
    }
}</div>
        </div>

        <!-- Configuration -->
        <div class="step">
            <h2>Step 4: Configure Admin Access</h2>
            
            <div class="warning">
                <strong>‚ö†Ô∏è Security Configuration Required</strong>
                <p style="margin-top: 10px;">Update these values in your code:</p>
            </div>

            <div class="code-section">
                <p><strong>In the openAdminDatabase() function, update:</strong></p>
            </div>

            <div class="code-block">// Add your actual admin Member IDs
const ADMIN_IDS = [
    'TSK-123456-789',  // Your admin TASK ID
    'TLK-123456-789'   // Your admin TALK ID
];

// Add admin email addresses
const ADMIN_EMAILS = [
    'your.admin@email.com',
    'grouptauafrica@gmail.com'
];

// Change the access code
const correctCode = 'YourSecureCode123'; // Change this!</div>
        </div>

        <!-- Testing -->
        <div class="step">
            <h2>Step 5: Testing the System</h2>
            
            <div class="instruction">
                <strong>üß™ Test Checklist:</strong>
                <ol style="margin-top: 10px;">
                    <li>Register a test member</li>
                    <li>Login as that member</li>
                    <li>Click "Admin & Validator Access" button</li>
                    <li>Enter admin code or use admin member ID</li>
                    <li>Database should open in new tab</li>
                    <li>Click "Validate" tab in database</li>
                    <li>Add test activity/task for a member</li>
                    <li>Approve/reject and check notifications</li>
                </ol>
            </div>
        </div>

        <!-- Additional Features -->
        <div class="step">
            <h2>üéÅ Bonus: Floating Admin Button (Optional)</h2>
            
            <div class="code-section">
                <p><strong>Add this anywhere in your index (46).html body for a persistent admin button:</strong></p>
            </div>

            <div class="code-block"><!-- Floating Admin Button -->
<div style="position: fixed; bottom: 170px; right: 30px; width: 60px; height: 60px; 
            background: linear-gradient(45deg, #667eea, #764ba2); border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            color: white; font-size: 24px; cursor: pointer; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 100;" 
     onclick="openAdminDatabase()" 
     title="Admin Access">
    üë®‚Äçüíº
</div></div>
        </div>

        <!-- Summary -->
        <div class="admin-card" style="margin-top: 40px;">
            <h2 style="color: white; margin: 0 0 15px 0;">‚úÖ Implementation Complete!</h2>
            <p><strong>What You Now Have:</strong></p>
            <ul style="margin-top: 10px; line-height: 1.8;">
                <li>‚úì Admin access button in member login</li>
                <li>‚úì Role-based access control</li>
                <li>‚úì Activity & Task validation interface</li>
                <li>‚úì Automatic notifications to members</li>
                <li>‚úì Earning limit enforcement</li>
                <li>‚úì Secure admin code protection</li>
            </ul>
        </div>

        <div class="warning" style="margin-top: 20px;">
            <strong>üìå Important Notes:</strong>
            <ul style="margin-top: 10px;">
                <li>Change the default admin access code</li>
                <li>Add your actual admin Member IDs</li>
                <li>Test all features before going live</li>
                <li>Keep backup of your database regularly</li>
            </ul>
        </div>
    </div>
</body>
  </html>
